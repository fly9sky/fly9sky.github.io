---
layout: post
title: 魔百盒M401a玩转Coreelec
description: 魔百盒M401a玩转Coreelec S905L3a芯片的盒子类似
date: 2023-01-13 09:01:01
---

### 下载写镜像改dub.img

### U盘启动

> adb reboot update 后瞬间插入u盘

### 写入emmc

> 打开系统 ssh 功能，电脑 ssh 连接后同样使用 ceemmc -x 命令，然后按喜好设置既可 默认密码 root coreelec

### 使用docket加载天翼网盘 阿里云盘

#### 安装docker 

```
输入 docker info 确认有正常运行

输入 docker pull cloudnas/clouddrive  拉取安装文件
```

#### 设置SMB共享

```
CE设置-服务-改为SMB1

/storage/.config/samba.conf，增加以下：

[CloudDrive]

  path = /storage/Clouddrive/CloudDrive/

  available = yes

  browseable = yes

  public = yes

  writeable = yes

```

#### CoreELEC的缓存设置

> /storage/.kodi/userdata/Advancedsettings.xml 文件内容如下，2G内存的设备可以设置300M缓存

```
<advancedsettings>
  <cache>
    <buffermode>1</buffermode>
    <memorysize>314572800</memorysize>
    <readfactor>25</readfactor>
  </cache>
</advancedsettings>
```

#### 启动 clouddrive

```
docker run -d \
--name clouddrive \
--restart unless-stopped \
-v /storage/Clouddrive:/CloudNAS:shared \
-v /storage/Clouddrive/Config:/Config \
--network host \
--pid host \
--privileged \
--device /dev/fuse:/dev/fuse \
cloudnas/clouddrive

然后就可以通过 Ip 9798端口访问 例如我的就是
http://192.168.0.179:9798/

docker rm 9cd7796a669d054f3634e8ac8427508b5e48c32094923034c3d9c0c1045246f1

docker rm  "/clouddrive"

docker  rm $(docker ps -a -q)
```

### 蓝牙遥控


#### mbh文件

```
# table mbh, type: NEC
0x22dc KEY_POWER #电源
0x22ca KEY_UP #向上
0x2299 KEY_LEFT #向左
0x22c1 KEY_RIGHT #向右
0x22d2 KEY_DOWN #向下
0x2292 KEY_1
0x2293 KEY_2
0x22cc KEY_3
0x228e KEY_4
0x228f KEY_5
0x22c8 KEY_6
0x228a KEY_7
0x228d KEY_8
0x22c4 KEY_9
0x2287 KEY_0
0x22f0 KEY_DOT #M键/点号
0x22d0 KEY_BACKSPACE #删除
0x2288 KEY_HOME #主页
0x2282 KEY_CONTEXT_MENU #菜单
0x22ce KEY_ENTER #选中/确定
0x2295 KEY_ESC #返回
0x228d KEY_CONFIG #设置
0x22da KEY_STOP #按键区的电源键
0x2281 KEY_VOLUMEDOWN #音量-
0x2280 KEY_VOLUMEUP #音量+
0x229c KEY_MUTE #静音
0x2285 KEY_PLAYPAUSE #播放停止按键区的TV/AV键
```
#### rc_maps_cfg文件添加行

···
meson-ir	*		mbh
···

### 蓝牙遥控确认键问题


```
I: Bus=0005 Vendor=0416 Product=0300 Version=0505
N: Name="CMCC_Voice_Remote"
P: Phys=12:00:00:a8:e5:10
S: Sysfs=/devices/virtual/misc/uhid/0005:0416:0300.0003/input/input7
U: Uniq=0c:f3:cc:31:2d:e9
H: Handlers=sysrq kbd leds mouse1 event6
B: PROP=0
B: EV=12001f
B: KEY=3007f 0 0 0 0 483ffff 17aff32d bf544446 0 0 70001 130ff3 8b17c007 ffff7bfa d9415fff febeffdf ffefffff ffffffff fffffffe
B: REL=143
B: ABS=1 0
B: MSC=10
B: LED=1f
```

```
systemctl stop kodi
systemctl stop eventlircd
evtest /dev/input/event6(需要安装 system tools 插件)


Event: time 1673748252.082007, type 20 (EV_REP), code 0 (REP_DELAY), value 500
Event: time 1673748252.082007, type 4 (EV_MSC), code 4 (MSC_SCAN), value 70066
Event: time 1673748252.082007, type 1 (EV_KEY), code 116 (KEY_POWER), value 1
Event: time 1673748252.082007, -------------- SYN_REPORT ------------
Event: time 1673748252.281985, type 4 (EV_MSC), code 4 (MSC_SCAN), value 70066
Event: time 1673748252.281985, type 1 (EV_KEY), code 116 (KEY_POWER), value 0
Event: time 1673748252.281985, -------------- SYN_REPORT ------------
Event: time 1673748307.050762, type 4 (EV_MSC), code 4 (MSC_SCAN), value c0041
Event: time 1673748307.050762, type 1 (EV_KEY), code 353 (KEY_SELECT), value 1
Event: time 1673748307.050762, -------------- SYN_REPORT ------------
Event: time 1673748307.250770, type 4 (EV_MSC), code 4 (MSC_SCAN), value c0041
Event: time 1673748307.250770, type 1 (EV_KEY), code 353 (KEY_SELECT), value 0
Event: time 1673748307.250770, -------------- SYN_REPORT ------------



开关机 70066
确定 C0041

/etc/udev/hwdb.d/*..hwdb

evdev:input:b0005v0416p0300*
 KEYBOARD_KEY_c0041=enter
 KEYBOARD_KEY_70066=sleep
 
 
配置生效

重启服务

systemd-hwdb update

udevadm trigger

systemctl start eventlircd

systemctl start kodi

输入确定按键生效命令：

udevadm info /dev/input/event4 | grep KEYBOARD_KEY 

```

### 蓝牙重启后失效

> udevadm info /sys/bus/sdio/devices/sdio* | paste

#### reinstalled both TVheadend and all OK

> killall -9 hciattach

> /usr/bin/hciattach -n -s 115200 /dev/ttyS1 bcm43xx 2000000

> systemctl unmask brcmfmac_sdio-firmware-aml


> echo "ln -s /usr/lib/kernel-overlays/base/lib/firmware/brcm/BCM4335_V0343.0353.hcd /var/lib/firmware/brcm/BCM4335AO.hcd" >> /storage/.config/autostart.sh

> reboot

> There is no reason your device should not be working as the firmware is there.Revert the previous command with the following.

```
systemctl unmask brcmfmac_sdio-firmware-aml
reboot
```

> When your device comes back up paste the output of hciconfig -a.


Hi @Newoski, I had the same problem with a Harmony Hub before and used this:

#### https://discourse.coreelec.org/t/odroid-n2-bluetooth-wont-auto-reconnect-after-reboot/7702/3

> \# /storage/.config/system.d/harmony.service
[Unit]
Description=Connect to Harmony on BT on startup and resume
After=suspend.target bluetooth.service

[Service]
Type=oneshot
ExecStart=/usr/bin/sh -c "for i in 1 2 3 4 5; do if bluetoothctl connect 00:04:20:F4:F1:22; then exit; else if [ $i -eq 5 ]; then exit $?; else sleep 5; fi; fi; done"
TimeoutSec=0

[Install]
WantedBy=multi-user.target sleep.target
But it seems to do be doing fine without it for a while now (I’m at 9.2.0 on a generic S905X2 box with an external BT dongle).


Created /storage/.config/system.d/harmony.service
then
chmod a+x /storage/.config/system.d/harmony.service
then
Added contents you shared with my bluetooth address

Is that right? Which dongle are you using? Do you know a model?


Saviq
Nov '19
chmod a+x /storage/.config/system.d/harmony.service

FWIW this was wrong, the right way to enable the systemd service is using systemctl:

systemctl enable harmony.service


Hi I know it’s an old thread but I have the same issue.
I have an Odroid N2 with the generic Bluetooth dongle sold by Ameridroid and Harmony hub.
I lost connection on reboot (Mac address change ?)

I try Saviq solution with no success

All idea are welcome


#### See below

> https://discourse.coreelec.org/t/solved-bluetooth-not-working/6983/72?filter=summary


### 蓝牙遥控启动

> 暂无解决

### 直播源配置

> 安装PVR IPTV Simple Client 插件
> 网上下载m3u8配置文件并导入
> 目前直播普遍比较卡顿 待优化
